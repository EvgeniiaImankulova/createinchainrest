<div class="page-container">
  <div class="page-header">
    <div class="header-left">
      <button class="btn-back" (click)="cancel()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <h1 class="page-title">
        {{ isEditMode ? 'Редактировать ресторан' : 'Создать ресторан' }}
      </h1>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="saveDraft()" [disabled]="isSaving">
        Сохранить как черновик
      </button>
      <button class="btn-primary" (click)="saveRestaurant()" [disabled]="isSaving || !isFormValid">
        {{ isEditMode ? 'Сохранить' : 'Создать' }}
      </button>
    </div>
  </div>

  <div class="tabs-container">
    <button
      class="tab"
      [class.active]="activeTab === 'general'"
      (click)="setActiveTab('general')">
      ОБЩИЕ
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'hours'"
      (click)="setActiveTab('hours')">
      ЧАСЫ РАБОТЫ
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'warehouse'"
      (click)="setActiveTab('warehouse')">
      СКЛАД
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'terminals'"
      (click)="setActiveTab('terminals')">
      ТЕРМИНАЛЫ
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'external'"
      (click)="setActiveTab('external')">
      ВНЕШНИЕ
    </button>
  </div>

  <div class="page-content" *ngIf="activeTab === 'general'">
    <div class="form-card">
      <div class="status-row">
        <div class="status-label">
          Статус подключения
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="info-icon">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 7V11M8 5V5.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="status-badge" [class.connected]="form.connection_status === 'connected'" [class.disconnected]="form.connection_status === 'disconnected'">
          {{ form.connection_status === 'connected' ? 'Подключен' : 'Не подключен' }}
        </div>
        <div class="timezone-text">Часовой пояс: {{ form.timezone }}</div>
      </div>

      <h2 class="section-title">Основная информация</h2>

      <h3 class="subsection-title">Общие сведения</h3>

      <div class="form-group">
        <label class="form-label">Название*</label>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="form.name"
          placeholder="Название ресторана"
          required>
      </div>

      <div class="form-group">
        <label class="form-label">Описание</label>
        <textarea
          class="form-textarea"
          [(ngModel)]="form.description"
          placeholder="Описание ресторана"
          rows="3"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Краткое название</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.short_name"
            placeholder="Краткое название">
        </div>

        <div class="form-group">
          <label class="form-label">Код</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.code"
            placeholder="Код ресторана">
        </div>
      </div>

      <h3 class="subsection-title">Юридическая информация</h3>

      <div class="form-group">
        <app-searchable-select
          [label]="'Юридическое лицо'"
          [options]="legalEntityOptions"
          [placeholder]="'Поиск...'"
          [(ngModel)]="form.legal_entity_id"
          name="legalEntity">
        </app-searchable-select>
      </div>

      <h3 class="subsection-title">Настройки</h3>

      <div class="form-group">
        <app-searchable-select
          [label]="'Шаблон ресторана'"
          [options]="templateOptions"
          [placeholder]="'Поиск...'"
          [(ngModel)]="form.template"
          name="template">
        </app-searchable-select>
      </div>

      <div class="form-group">
        <label class="form-label">Часовой пояс</label>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="form.timezone"
          placeholder="Часовой пояс">
      </div>

      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input
            type="checkbox"
            [(ngModel)]="form.is_franchise"
            (ngModelChange)="onFranchiseChange()">
          <span>Франчайзи</span>
        </label>
      </div>

      <div class="form-group" *ngIf="form.is_franchise">
        <label class="form-label">Процент роялти, %</label>
        <input
          type="number"
          class="form-input"
          [(ngModel)]="form.royalty_percent"
          placeholder="0"
          min="0"
          max="100"
          step="0.01">
      </div>

      <h3 class="subsection-title">Адрес</h3>

      <div class="form-group">
        <label class="form-label">Название улицы и дом*</label>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="form.address_street"
          placeholder="Например: ул. Ленина, д. 10, кв. 5"
          required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Город/населенный пункт*</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.address_city"
            placeholder="Введите город"
            required>
        </div>

        <div class="form-group">
          <label class="form-label">Область/регион*</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.address_region"
            placeholder="Введите регион"
            required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Страна*</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.address_country"
            placeholder="Введите страну"
            required>
        </div>

        <div class="form-group">
          <label class="form-label">Почтовый код</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="form.address_postal_code"
            placeholder="Введите почтовый код">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Комментарии к адресу</label>
        <textarea
          class="form-textarea"
          [(ngModel)]="form.address_comment"
          rows="2"
          placeholder="Дополнительная информация об адресе"></textarea>
      </div>

      <div class="map-link-wrapper">
        <svg class="map-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 10C10.5304 10 11.0391 9.78929 11.4142 9.41421C11.7893 9.03914 12 8.53043 12 8C12 7.46957 11.7893 6.96086 11.4142 6.58579C11.0391 6.21071 10.5304 6 10 6C9.46957 6 8.96086 6.21071 8.58579 6.58579C8.21071 6.96086 8 7.46957 8 8C8 8.53043 8.21071 9.03914 8.58579 9.41421C8.96086 9.78929 9.46957 10 10 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 8C16 13 10 17 10 17C10 17 4 13 4 8C4 6.4087 4.63214 4.88258 5.75736 3.75736C6.88258 2.63214 8.4087 2 10 2C11.5913 2 13.1174 2.63214 14.2426 3.75736C15.3679 4.88258 16 6.4087 16 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <a href="#" class="map-link" (click)="$event.preventDefault()">Показать на карте</a>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Широта*</label>
          <input
            type="number"
            class="form-input"
            [(ngModel)]="form.address_latitude"
            placeholder="55.751244"
            step="0.000001">
        </div>

        <div class="form-group">
          <label class="form-label">Долгота*</label>
          <input
            type="number"
            class="form-input"
            [(ngModel)]="form.address_longitude"
            placeholder="37.618423"
            step="0.000001">
        </div>
      </div>

      <h3 class="subsection-title">Контактная информация</h3>

      <div class="form-group">
        <app-searchable-select
          [label]="'Владелец ресторана'"
          [options]="ownerOptions"
          [placeholder]="'Поиск...'"
          [(ngModel)]="form.owner_id"
          (ngModelChange)="onOwnerSelect($event)"
          name="owner">
        </app-searchable-select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Телефон владельца</label>
          <input
            type="tel"
            class="form-input"
            [(ngModel)]="form.owner_phone"
            placeholder="+7 (___) ___-__-__">
        </div>

        <div class="form-group">
          <label class="form-label">Email владельца</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="form.owner_email"
            placeholder="example@restaurant.ru">
        </div>
      </div>

      <div class="form-group">
        <app-searchable-select
          [label]="'Главный бухгалтер'"
          [options]="accountantOptions"
          [placeholder]="'Поиск...'"
          [(ngModel)]="form.accountant_id"
          (ngModelChange)="onAccountantSelect($event)"
          name="accountant">
        </app-searchable-select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Телефон бухгалтера</label>
          <input
            type="tel"
            class="form-input"
            [(ngModel)]="form.accountant_phone"
            placeholder="+7 (___) ___-__-__">
        </div>

        <div class="form-group">
          <label class="form-label">Email бухгалтера</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="form.accountant_email"
            placeholder="example@restaurant.ru">
        </div>
      </div>
    </div>
  </div>

  <div class="page-content" *ngIf="activeTab === 'hours'">
    <div class="form-card">
      <h2 class="section-title">Часы работы</h2>
      <p class="placeholder-text">Настройки часов работы будут добавлены позже</p>
    </div>
  </div>

  <div class="page-content" *ngIf="activeTab === 'warehouse'">
    <div class="form-card">
      <h2 class="section-title">Настройки склада</h2>
      <p class="placeholder-text">Настройки склада будут добавлены позже</p>
    </div>
  </div>

  <div class="page-content" *ngIf="activeTab === 'terminals'">
    <div class="form-card">
      <h2 class="section-title">Настройки терминалов</h2>
      <p class="placeholder-text">Настройки терминалов будут добавлены позже</p>
    </div>
  </div>

  <div class="page-content" *ngIf="activeTab === 'external'">
    <div class="form-card">
      <h2 class="section-title">Внешние настройки</h2>
      <p class="placeholder-text">Внешние настройки будут добавлены позже</p>
    </div>
  </div>
</div>

<app-employee-sidebar
  [(isOpen)]="isEmployeeSidebarOpen"
  (employeeCreated)="onEmployeeCreated($event)">
</app-employee-sidebar>
